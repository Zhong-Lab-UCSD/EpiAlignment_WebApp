<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EpiAlignment - Result</title>
  <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet" type="text/css">
  <link href="https://cdn.jsdelivr.net/npm/vuetify@1.5.11/dist/vuetify.min.css" rel="stylesheet" type="text/css">
  <link href="styles/mainstyles.css" rel="stylesheet" type="text/css">
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-78231712-3"></script>
  <script src="js/googleAnalytics.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/vuetify@1.5.11/dist/vuetify.min.js"></script>
  <script defer src="js/lib/moment.min.js"></script>
  <script defer src="js/lib/moment-timezone-with-data.min.js"></script>
  <script defer src="js/result.js" type="module"></script>
</head>

<body>
  <div id="header" class="result noFlex flexRow flexCenter flexWrap">
    <div id="headerContainer" class="flex flexColumn flexStretch flexNoWrap flexNoGap">
      <h1 class="flex"><a href="index.html">EpiAlignment</a></h1>
    </div>
    <div id="headerButtonHolder" class="flex flexRow flexWrap flexCenter justifyEnd">
      <a class="buttons flexRow flexCenter justifyCenter" target="_blank" href="manual.html"><i class="material-icons">help_outline</i>Manual</a>
      <a class="buttons flexRow flexCenter justifyCenter" title="A template python program that can be used to access EpiAlignment"
        target="_blank" href="assets/PythonClient.zip"><i class="material-icons">save_alt</i>Python
        client template</a>
    </div>
  </div>
  <div data-app id="result_app" class="flex flexColumn flexStretch" v-cloak>
    <div id="runInfo" class="noFlex">
      <div v-show="!showRunDetails" class="collapsedRunInfo noFlex flexRow flexCenter flexWrap flexNoGap justifyStart">
        <div class="noFlex flexRow flexWrap flexNoGap justifyStart" v-for="row in collapsedRunInfoList">
          <div class="flexRow flexWrap noFlex flexStart flexNoGap" :class="{ parameter: entry.parameter }" v-for="entry in row">
            <span class="entryKey" v-html="entry.key"></span>
            <span class="entryValue">{{ entry.value }}</span>
          </div>
        </div>
        <div class="runInfoShowHide selfAlignStart" @click="showRunInfoDetails">Show more details ...</div>
      </div>
      <div v-show="showRunDetails" class="expandedRunInfo noFlex flexColumn flexNoWrap flexNoGap">
        <div class="noFlex flexRow flexWrap flexNoGap justifyStart" v-for="row in expandedRunInfoList">
          <div class="flexRow flexWrap noFlex flexStart flexNoGap" :class="{ parameter: entry.parameter }" v-for="entry in row">
            <span class="entryKey" v-html="entry.key"></span>
            <span class="entryValue">{{ entry.value }}</span>
          </div>
        </div>
        <div class="runInfoShowHide selfAlignStart" @click="foldRunInfoDetails">Fold details</div>
      </div>
    </div>
    <div class="errorContainer" v-if="error">
      <p>Error encountered when calculating your results. Please check your inputs
        and try again.</p>
      <p> If you have any questions, please use the "Contact us via
        email" link at the bottom of the page to report the problems, or report
        the issue via Github from the "Find us on Github" link. Please include
        your Run ID (shown above) when reporting an error.
      </p>
      <p>Error message:
        <code class="codeParagraph">{{ errorMessage }}</code>
      </p>
    </div>
    <div class="errorContainer warning" v-if="showWarning && !error">
      <div class="tooltipPanel flexColumn">
        <div class="flexRow flexWrap flexNoGap">
          <div class="flex">The following warning(s) occured during
            the alignment run:</div>
          <div class="closeError noFlex" v-show="loading">
            <em>You may hide the warning(s) once the job is done.</em>
          </div>
          <div class="closeError noFlex" v-show="!loading">
            <i class="material-icons button" @click="closeWarning()">close</i>
          </div>
        </div>
        <code class="codeParagraph">{{ errorMessage }}</code>
      </div>
    </div>
    <div class="loadingHolder flexColumn flexStretch" v-show="loading">
      <h3>Calculating...</h3>
      <img class="selfAlignStart" src="assets/images/loading.gif">
      <div>
        Please wait: your data is still being computed.
        <strong>
          This page will automatically refresh every {{ pollingTime / 1000 }} seconds.
        </strong>
      </div>
      <div :class=" { highlightBlink: highlightLoading } ">
        Last refreshed at: 
        <strong>
          {{ lastRefreshedTime }}
        </strong>
      </div>
      <div>
        You may bookmark this page now and check back later. To
        bookmark this page, please press <span class="keyboard">Ctrl</span> +
        <span class="keyboard">D</span> (on a PC) or
        <span class="keyboard">⌘ Command</span> +
        <span class="keyboard">D</span>
        (on a Mac) and follow the instructions of your web browser (if any).
        Once the results are available, you may fetch your results via the
        bookmarked page in <strong>14 days</strong>.
      </div>
      <div v-show="alignMode === 'enhancer' && !email">
        Due to the many processing steps and larger search regions
        involved, one-to-one mode may take minutes to run. Therefore,
        <strong>bookmarking this page is highly recommended</strong>.
      </div>
      <div v-show="email">
        You will also receive an email at your email address at
        {{ email }} once the computation is done. <strong>Note: </strong>
        please check your spam folder regularly, or make sure
        messenger@mail.givengine.org is on
        your approved sender list ("white list") and/or in your address book.
      </div>
    </div>
    <div id="pageContainer" class="flexRow flexStart flexWrap flexNoGap" v-if="!loading && !error">
      <div id="heatmapPanel" class="flexRow flexStart flex flexWrap" v-if="alignMode === 'promoter'">
        <div id="heatmap" class="borderedPanel">
          <div class="flexColumn flexStart">
            <div class="selfAlignStretch resultHeader"><span class="headerText">EpiAlign score</span></div>
            <table>
              <thead>
                <tr>
                  <th class="placeholder"></th>
                  <th class="heatmapColLabels" v-for="entry in promoterColumnList">
                    <div>
                      {{ entry }}
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="rowEntry in epiHeatmapList">
                  <th>{{ rowEntry.geneId }}</th>
                  <td class="heatmapCell" v-for="value in rowEntry.values">
                    <div class="heatmapObj">
                      <div class="heatmapBorder"
                        :class="{ seqMax: value.seqMax && rowEntry.labelMax, epiMax: value.epiMax && rowEntry.labelMax, insignificant: value.insignificant }">
                      </div>
                      <div class="heatmapValueCell"
                        :style="{ opacity: (Number.isNaN(parseFloat(value.epiScoreNorm)) ? 1 : value.epiScoreNorm) }">
                      </div>
                      <div class="overlay flexRow flexNoWrap flexCenter justifyCenter" v-show="value.epiMax">H</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
            <div v-if="hasSequence" class="selfAlignStretch resultHeader"><span class="headerText">SeqOnly score</span></div>
            <table v-if="hasSequence">
              <thead>
                <tr>
                  <th class="placeholder"></th>
                  <th class="heatmapColLabels" v-for="entry in promoterColumnList">
                    <div>{{ entry }}</div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="rowEntry in epiHeatmapList">
                  <th>{{ rowEntry.geneId }}</th>
                  <td class="heatmapCell" v-for="value in rowEntry.values">
                    <div class="heatmapObj">
                      <div class="heatmapBorder"
                        :class="{ seqMax: value.seqMax && rowEntry.labelMax, epiMax: value.epiMax && rowEntry.labelMax, insignificant: value.insignificant }">
                      </div>
                      <div class="heatmapValueCell"
                        :style="{ opacity:  (Number.isNaN(parseFloat(value.seqScoreNorm)) ? 1 : value.seqScoreNorm) }">
                      </div>
                      <div class="overlay flexRow flexNoWrap flexCenter justifyCenter" v-show="value.seqMax">H</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
            <div id="heatmapLegend" class="selfAlignStretch flexColumn flexStretch flexNoGap flexNoWrap figureLegend">
              <!-- Scale bar -->
              <div class="flexRow flexCenter flexNoWrap">
                <div class="flexRow flexEnd flexNoGap noFlex" id="colorScaleGroup">
                  {{ Number.parseFloat(heatmapDesc.min).toFixed(2) }}
                  <div id="colorScaleContainer">
                    <!-- 95th percentile indicator -->
                    <div id="percentile95" v-if="heatmapDesc.showPercentile"
                      :style="{ 'margin-left': (heatmapDesc.percentileValue - heatmapDesc.min) / heatmapDesc.span * 100 + '%' }">
                      <span>{{ Number.parseFloat(heatmapDesc.percentileValue).toFixed(2) }}</span>
                    </div>
                    <div id="colorScale"></div>
                  </div>
                  {{ Number.parseFloat(heatmapDesc.max).toFixed(2) }}
                </div>
                <div class="flex">Alignment score</div>
              </div>
              <!-- H sign -->
              <div class="flexRow flexStart flexNoWrap">
                <div class="flexRow flexCenter noFlex flexNoGap flexNoWrap" :class="{ withPercentile: percentileEnabled }">
                  <div class="legendIcon heatmapObj noFlex plain">
                    <div class="overlay flexRow flexNoWrap flexCenter justifyCenter">H</div>
                  </div>
                </div>
                <div class="flex">Target with highest score</div>
              </div>
              <!-- Seq-best pair -->
              <div v-if="hasSequence" class="flexRow flexStart flexNoWrap">
                <div class="flexRow flexCenter noFlex flexNoGap flexNoWrap" :class="{ withPercentile: percentileEnabled }">
                  <div class="legendIcon heatmapBorder epiMax noFlex"></div>
                  <div v-if="percentileEnabled" class="legendIcon heatmapBorder epiMax noFlex insignificant"></div>
                </div>
                <div class="flex">Shifted EpiAlign target</div>
              </div>
              <div v-if="hasSequence" class="flexRow flexStart flexNoWrap">
                <div class="flexRow flexCenter noFlex flexNoGap flexNoWrap" :class="{ withPercentile: percentileEnabled }">
                  <div class="legendIcon heatmapBorder seqMax noFlex"></div>
                  <div v-if="percentileEnabled" class="legendIcon heatmapBorder seqMax noFlex insignificant"></div>
                </div>
                <div class="flex">Original sequence-only alignment target</div>
              </div>
            </div>
          </div>
        </div>
        <div id="expressionBar" v-if="!!expList" class="borderedPanel">
          <div class="flexColumn flexNoGap">
            <div class="selfAlignStretch resultHeader"><span class="headerText">Gene expression values</span></div>
            <div class="flexShrink flexColumn">
              <!-- SVG bar content -->
              <svg :width="expFigProp.width" :height="getExpressionHeight(expList)">
                <svg v-for="(expInRef, refIndex) in expList" :width="expFigProp.width"
                  :height="getExpInRefHeight(expInRef)" x="0" :y="getExpInRefY(expList, refIndex)">
                  <text :x="expFigProp.textAreaWidth - expFigProp.textMargin" :y="(expFigProp.refHeight + expFigProp.textSize - expFigProp.gap) / 2"
                    :style="{ fontSize: expFigProp.axisLabelSize, fontWeight: 'bold' }" text-anchor="end">{{ capitalize(expInRef.refName) }}</text>
                  <svg v-for="(geneEntry, geneIndex) in expInRef.expValues" :width="expFigProp.width"
                    :height="expFigProp.geneHeight" x="0" :y="geneIndex * (expFigProp.geneHeight + expFigProp.gap) + expFigProp.refHeight">
                    <text :x="expFigProp.textAreaWidth - expFigProp.textMargin" :y="(expFigProp.geneHeight + expFigProp.textSize - expFigProp.gap) / 2"
                      :style="{ fontSize: expFigProp.axisLabelSize }" text-anchor="end">{{ geneEntry.symbol }}</text>
                    <rect v-for="(expValue, index) in geneEntry.indExpValues"
                      :x="expFigProp.textAreaWidth" :y="index * expFigProp.geneHeight / geneEntry.indExpValues.length"
                      :width="getXExpression(expList, expValue.FPKM) - expFigProp.textAreaWidth" :height="expFigProp.geneHeight / geneEntry.indExpValues.length"
                      :style="{ fontSize: figProp.axisLabelSize, fill: '#' + getColorString(expList, refIndex, index) }"/>
                  </svg>
                </svg>
                <line :x1="expFigProp.textAreaWidth" :y1="expFigProp.gap - 0.5" :x2="expFigProp.textAreaWidth"
                  :y2="getExpressionHeight(expList)" class="seqCompAxis" />
              </svg>
            </div>
            <div class="noFlex flexNoWrap">
              <!-- SVG bottom axis -->
              <svg :width="expFigProp.width" :height="expFigProp.axisHeight">
                <defs>
                  <marker id="arrowHead" markerWidth="10" markerHeight="10" refx="2" refy="5" orient="auto">
                    <path d="M0 2 L2 5 L0 8 L10 5 L0 2" />
                  </marker>
                </defs>
                <line :x1="expFigProp.textAreaWidth" :y1="0" :x2="expFigProp.textAreaWidth"
                  :y2="expFigProp.gap - 0.5" class="seqCompAxis" />
                <line :x1="expFigProp.textAreaWidth" :y1="expFigProp.gap - 0.5" :x2="expFigProp.width - expFigProp.horizMargin"
                  :y2="expFigProp.gap - 0.5" class="seqCompAxis" marker-end="url(#arrowHead)" />
                <!-- Draw all the tick marks -->
                <g v-for="tick in getTickList(0, getExpressionMax(expList), expFigProp.maxNumOfTicks)">
                  <line :x1="getXExpression(expList, tick)" :y1="expFigProp.gap - 0.5" :x2="getXExpression(expList, tick)"
                    :y2="expFigProp.gap + expFigProp.tickSize - 0.5" class="seqCompAxis" />
                  <text :x="getXExpression(expList, tick)" :y="expFigProp.gap + expFigProp.tickSize + expFigProp.axisLabelSize - 0.5"
                    :style="{ fontSize: expFigProp.axisLabelSize }" text-anchor="middle">{{ tick }}</text>
                </g>
                <text :x="(expFigProp.width + expFigProp.textAreaWidth - expFigProp.horizMargin) / 2"
                  :y="expFigProp.gap * 2 + expFigProp.tickSize + expFigProp.axisLabelSize + expFigProp.textSize - 0.5"
                  :style="{ fontSize: expFigProp.textSize, fontWeight: 'bold' }" text-anchor="middle">FPKM</text>
              </svg>
            </div>
            <div class="noFlex flexRow flexWrap flexNoGap figureLegend">
              <!-- Legend for expression, populate from expInRef.expIds -->
              <template v-for="(expInRef, refIndex) in expList">
                <div v-for="(expId, expIndex) in expInRef.expIds"
                  class="flexRow flexCenter flexNoWrap flexNoGap noFlex expLegendEntry">
                  <div class="expColorSquare"
                    :style="{ background: '#' + getColorString(expList, refIndex, expIndex) }">
                  </div>
                  <a v-if="buildLinkFromExpressionId(expId)"
                    :href="buildLinkFromExpressionId(expId)"
                    target="_blank">{{ expId }}</a>
                  <span v-else>{{ expId }}</span>
                </div>
              </template>
            </div>
          </div>
        </div>
        <div id="heatmapDesc" class="flex">
          <div class="resultHeader"><span class="headerText">Result description</span></div>
          <p>
            EpiAlignment score are plotted in the heatmap to show scores of
            all given target region(s) (column) against any query region (row).
          </p>
          <p>
            A sequence-only alignment result is also provided for comparative
            purposes. This result should be similar to a sequence alignment
            algorithm.
          </p>
          <p>
            EpiAlignment can detects if the best it for any query region (row)
            switches from one target region to another with EpiAlign and
            Sequence-only alignment. For any query region, if:
            <ul>
              <li>
                the best hit region with EpiAlign (<em>the new hit</em>) is
                different from the best hit region with Sequence-only (<em>the
                  old hit</em>), and
              </li>
              <li>
                <em>the new hit</em> has a <em>higher</em> score with
                EpiAlign than with Sequence-only alignment, and
              </li>
              <li>
                <em>the old hit</em> has a <em>lower</em> score with
                EpiAlign than with Sequence-only alignment,
              </li>
            </ul>
            <em>the new hit</em> will be marked on the heatmap with a green
            square ( <div class="legendIcon heatmapBorder epiMax"></div> ), and
            <em>the old hit</em> will be marked with a gray square (
            <div class="legendIcon heatmapBorder seqMax"></div>
            ).
            <span v-if="percentileEnabled">
              If <em>the new hit</em> has a lower Sequence-only score than the
              95th percentile of random sequences (marked on the color scale bar
              if it's not the maximum), the border of the square for both
              <em>the new hit</em> and <em>the old hit</em> will be dashed (
              <div class="legendIcon heatmapBorder epiMax insignificant"></div>
              and <div class="legendIcon heatmapBorder seqMax insignificant"></div>
              ).
            </span>
          </p>
          <p>
            <em>
              (Note: if you set epigenomic weight to zero during input,
              the EpiAlignment score will be the degenerated sequence-only
              alignment score, and no sequence-only result will be reported.)
            </em>
          </p>
        </div>
      </div>
      <div class="resultHolder flexColumn flexStretch flex flexNoGap">
        <div class="resultHeader flexRow flexWrap flexCenter flexNoGap">
          <span class="headerText">Result data table</span>
          <div class="flex descText">
            Click on table rows for detailed results.
          </div>
          <a class="buttonLink" :href="downloadLink" download="results.txt" target="_blank"><i class="material-icons">
              save_alt
            </i>
            Download results</a>
        </div>
        <div class="enhancerHint tooltipPanel flexRow flexNoGap flexWrap justifyEnd" v-if="showResultHint">
          <div class="hintContent flex">You may click 
            <div class="btnWithAnno"><i class="material-icons">open_in_new</i>
              <div class="annotation">GIVE</div>
            </div> in the front of each row to show a side-by-side
            view of the query and the target region in a browser powered by
            GIVE, or click on the
            <div class="btnWithAnno"><i class="material-icons">open_in_new</i><div class="annotation">UCSC</div></div>
            icon after each coordinate to open the region in UCSC Genome Browser.
          </div>
          <div class="closeHint nobr noFlex flexRow flexCenter flexNoGap">
            <input type="checkbox" v-model="doNotShowHintAgain" id="doNotShow">
            <label for="doNotShow">Do not show this again</label>
            <i class="material-icons button" @click="closeHint()">close</i>
          </div>
        </div>
        <v-data-table :headers="headers" :items="dataEntries" item-key="index" class="elevation-1" :pagination.sync="paginationObj"
          :rows-per-page-items="rowsPerPageItems" sort-icon="keyboard_arrow_up">
          <template slot="no-data">
          </template>
          <template slot="headerCell" slot-scope="props">
            <v-tooltip bottom v-if="props.header.tooltip">
              <template v-slot:activator="{ on }">
                <span v-on="on">
                  <span v-if="props.header.html" v-html="props.header.html">
                  </span>
                  <span v-else>
                    {{ props.header.text }}
                  </span>
                </span>
              </template>
              <span>
                {{ props.header.tooltip }}
              </span>
            </v-tooltip>
            <span v-if="!props.header.tooltip">
              <span v-if="props.header.html" v-html="props.header.html">
              </span>
              <span v-else>
                {{ props.header.text }}
              </span>
            </span>
          </template>
          <template slot="items" slot-scope="row">
            <tr @click="toggleRow(row)" class="expandable">
              <td class="dataTableCell">{{ row.item.index }}</td>
              <td class="dataTableCell dataTableCellNoGap"><a @click.stop class="noFlex btnWithAnno" target="_blank" title="Open region in GIVE Browser"
                :href="getGiveLink([queryGenomeAssembly, targetGenomeAssembly], [row.item.region1, row.item.region2], [[row.item.region1], [row.item.targetE, row.item.targetS]])"><i class="material-icons">
                  open_in_new
                </i><div class="annotation">GIVE</div>
              </a></td>
              <td class="dataTableCell">{{ row.item[geneIdentifier1] }}</td>
              <td class="dataTableCell" v-if="row.item.ensID1 !== '.'">{{ row.item.ensID1 }}</td>
              <td class="dataTableCell">
                {{ row.item.region1 }} <a @click.stop class="noFlex btnWithAnno" target="_blank" title="Open region in UCSC Genome Browser"
                  :href="getUcscLink(queryGenomeAssembly, row.item.region1)"><i class="material-icons">
                    open_in_new
                  </i><div class="annotation">UCSC</div></a>
              </td>
              <td class="dataTableCell" v-if="row.item[geneIdentifier2] !== '.'">{{ row.item[geneIdentifier2] }}</td>
              <td class="dataTableCell" v-if="row.item.ensID2 !== '.'">{{ row.item.ensID2 }}</td>
              <td class="dataTableCell">
                {{ row.item.region2 }} <a @click.stop class="noFlex btnWithAnno" target="_blank" title="Open region in UCSC Genome Browser"
                  :href="getUcscLink(targetGenomeAssembly, row.item.region2)"><i class="material-icons">
                    open_in_new
                  </i><div class="annotation">UCSC</div></a>
              </td>
              <td class="dataTableCell" :class="{'text-xs-right': alignMode === 'promoter'}">{{ alignMode ===
                'promoter' ?
                Number.parseFloat(row.item.scoreE).toFixed(3) : row.item.targetE }}</td>
              <td class="dataTableCell" :class="{'text-xs-right': alignMode === 'promoter'}">
                {{ alignMode === 'promoter' ? (row.item.scoreS !== '.'
                  ? Number.parseFloat(row.item.scoreS).toFixed(3) : '---')
                : row.item.targetS !== '.' ? row.item.targetS : '---' }}</td>
              <td class="dataTableCell dataTableCellNoGap text-xs-left" v-if="alignMode === 'enhancer'">
                <v-tooltip bottom v-if="row.item.shifted === 'Y'">
                  <template v-slot:activator="{ on }">
                    <i class="material-icons" v-on="on">swap_horizontal_circle</i>
                  </template>
                  <span>
                    The EpiAlign hit is different from the SeqOnly hit.
                  </span>
                </v-tooltip>
              </td>
            </tr>
          </template>
          <template slot="expand" slot-scope="entry">
            <v-card flat>
              <div class="flexRow flexStretch enhancerCardContainer">
                <div class="resultImgHolder flexColumn flexCenter flexNoWrap flexNoGap noFlex justifyCenter"
                  v-if="alignMode === 'enhancer'"
                  :class="{ 'loading': !entry.item.imageError && !entry.item.image }">
                  <img v-show="entry.item.image && !entry.item.imageError" :src="entry.item.image">
                  <div v-show="entry.item.imageError">
                    {{ entry.item.imageError }}
                  </div>
                </div>
                <div class="flex resultDesc">
                  <div id="dataHelp" class="help flexRow flexCenter flexNoWrap">
                    <i class="material-icons iconAtLeft">help</i>
                    <div>What do all these results mean?</div>
                  </div>
                  <div class="flexColumn dataPart flexNoGap" v-if="alignMode === 'enhancer'">
                    <div class="sectionHeader">Overview</div>
                    <div class="flexRow flexWrap flexNoGap flexCenter">
                      <div class="flexRow flexWrap noFlex flexStart flexNoGap dataEntry">
                        <span class="anno">EpiAlign hit score:</span>
                        <span>{{ Number.parseFloat(entry.item.scoreE).toFixed(3) }}</span>
                      </div>
                      <div v-if="entry.item.targetS !== '.'" class="flexRow flexWrap noFlex flexStart flexNoGap dataEntry">
                        <span class="anno">SeqOnly hit score:</span>
                        <span>{{ Number.parseFloat(entry.item.scoreS).toFixed(3) }}</span>
                      </div>
                    </div>
                    <div v-if="entry.item.shifted === 'Y'" class="flexRow flexWrap flexNoGap flexCenter">
                      <span class="flexRow flexCenter shiftedLabel noFlex">
                        <i class="material-icons">swap_horizontal_circle</i>
                        The EpiAlign hit is different from the SeqOnly hit.
                      </span>
                    </div>
                  </div>
                  <div class="flexColumn dataPart flexNoGap">
                    <div class="sectionHeader">Sequence evaluation</div>
                    <div v-if="!!entry.item.signalToNoise" class="flexRow flexWrap flexNoGap flexStart">
                      <div class="subHeader">Signal-to-noise ratio</div>
                      <div class="flexRow flex flexNoGap flexWrap flexEnd">
                        <div v-if="entry.item.signalToNoise.snE !== '.'" class="flexRow flexNoWrap noFlex flexStart flexNoGap dataEntry">
                          <span class="anno">EpiAlign hit:</span>
                          <span>{{ Number.parseFloat(entry.item.signalToNoise.snE).toFixed(3) }}</span>
                        </div>
                        <div v-if="entry.item.signalToNoise.snS !== '.'" class="flexRow flexNoWrap noFlex flexStart flexNoGap dataEntry">
                          <span class="anno">SeqOnly hit:</span>
                          <span>{{ Number.parseFloat(entry.item.signalToNoise.snS).toFixed(3) }}</span>
                        </div>
                      </div>
                    </div>
                    <div class="flexRow flexWrap flexNoGap flexStart">
                      <div class="subHeader">Context of sequence-only alignment scores</div>
                      <div class="svgGraphHolder flexColumn">
                        <svg id="seqScoreCompareSvg" :height="figProp.lineHeight * (alignMode === 'enhancer' ? 4 : 3)"
                          :width="figProp.width" class="svgGraph">
                          <defs>
                            <marker id="arrowHead" markerWidth="10" markerHeight="10" refx="2" refy="5" orient="auto">
                              <path d="M0 2 L2 5 L0 8 L10 5 L0 2" />
                            </marker>
                            <g id="crossMarker">
                              <line :x1="-figProp.crossSize" :y1="-figProp.crossSize" :x2="figProp.crossSize" :y2="figProp.crossSize" />
                              <line :x1="-figProp.crossSize" :y1="figProp.crossSize" :x2="figProp.crossSize" :y2="-figProp.crossSize" />
                            </g>
                          </defs>
                          <svg :width="figProp.width" :height="figProp.lineHeight"
                            x="0" :y="getLineY(0)">
                            <!-- Draw the two box plots -->
                            <rect :x="getXSeqScore(entry.item, seqBg.backgroundQ25)" :y="figProp.vertMargin"
                              :width="getXSeqScore(entry.item, seqBg.backgroundQ75) - getXSeqScore(entry.item, seqBg.backgroundQ25)"
                              :height="figProp.lineHeight - 2 * figProp.vertMargin" class="seqCompBackgroundBox" />
                            <line :x1="getXSeqScore(entry.item, seqBg.backgroundMedian)" :y1="figProp.vertMargin"
                              :x2="getXSeqScore(entry.item, seqBg.backgroundMedian)" :y2="figProp.lineHeight - figProp.vertMargin"
                              class="seqCompBackgroundMedian" />
                            <rect :x="getXSeqScore(entry.item, seqBg.orthoQ25)" :y="figProp.vertMargin"
                              :width="getXSeqScore(entry.item, seqBg.orthoQ75) - getXSeqScore(entry.item, seqBg.orthoQ25)"
                              :height="figProp.lineHeight - 2 * figProp.vertMargin" class="seqCompOrthoBox" />
                            <line :x1="getXSeqScore(entry.item, seqBg.orthoMedian)" :y1="figProp.vertMargin" :x2="getXSeqScore(entry.item, seqBg.orthoMedian)"
                              :y2="figProp.lineHeight - figProp.vertMargin" class="seqCompOrthoMedian" />
                            <!-- Draw the two cross marks -->
                            <use :class="{ seqCompCrossSeqMark: entry.item.shifted === 'Y', seqCompCrossEpiMark: entry.item.shifted !== 'Y' }"
                              xlink:href="#crossMarker" href="#crossMarker"
                              :x="getXSeqScore(entry.item, entry.item.scoreS)"
                              :y="figProp.lineHeight / 2" />
                            <use class="seqCompCrossEpiMark" xlink:href="#crossMarker" href="#crossMarker" v-if="entry.item.shifted === 'Y'"
                              :x="getXSeqScore(entry.item, entry.item.scoreS2)" :y="figProp.lineHeight / 2" />
                          </svg>
                          <!-- Draw the horizontal axis -->
                          <svg :width="figProp.width" :height="figProp.lineHeight" x="0" :y="getLineY(1)">
                            <line :x1="figProp.horizMargin / 2" :y1="figProp.vertMargin + 0.5"
                              :x2="figProp.width - figProp.horizMargin / 2" :y2="figProp.vertMargin + 0.5"
                              class="seqCompAxis" marker-end="url(#arrowHead)" />
                            <!-- Draw all the tick marks -->
                            <g v-for="tick in getTickList(getSeqScoreMin(entry.item), getSeqScoreMax(entry.item), figProp.maxNumOfTicks)">
                              <line :x1="getXSeqScore(entry.item, tick)" :y1="figProp.vertMargin + 0.5"
                                :x2="getXSeqScore(entry.item, tick)" :y2="figProp.vertMargin + figProp.tickSize + 0.5"
                                class="seqCompAxis" />
                              <text :x="getXSeqScore(entry.item, tick)"
                                :y="figProp.vertMargin + figProp.tickSize + figProp.axisLabelSize + 0.5"
                                :style="{ fontSize: figProp.axisLabelSize }"
                                text-anchor="middle">{{ tick }}</text>
                            </g>
                          </svg>
                          <!-- Draw the legends -->
                          <rect :x="0.5" :y="getLineY(2) - 0.5" :width="figProp.width - 1"
                            :height="figProp.lineHeight * (alignMode === 'enhancer' ? 2 : 1)" class="seqCompLegendBox" />
                          <!-- Draw the two box plots -->
                          <svg :width="figProp.width" :height="figProp.lineHeight" x="0" :y="getLineY(2)">
                            <rect :x="figProp.legendLeftX" :y="figProp.vertMargin + figProp.legendBoxOffset"
                              :width="figProp.legendBoxWidth"
                              :height="figProp.lineHeight - 2 * figProp.vertMargin" class="seqCompBackgroundBox" />
                            <line :x1="figProp.legendLeftX + figProp.legendBoxWidth / 2"
                              :y1="figProp.vertMargin + figProp.legendBoxOffset"
                              :x2="figProp.legendLeftX + figProp.legendBoxWidth / 2"
                              :y2="figProp.lineHeight - figProp.vertMargin + figProp.legendBoxOffset"
                              class="seqCompBackgroundMedian" />
                            <text :x="figProp.legendLeftX + figProp.legendBoxWidth + figProp.horizMargin / 2"
                              :y="(figProp.lineHeight + figProp.textSize) / 2 - figProp.vertMargin * 1.2 + figProp.legendBoxOffset"
                              :style="{fontSize: figProp.textSize}">Background</text>
                            <text :x="figProp.legendLeftX + figProp.legendBoxWidth + figProp.horizMargin / 2"
                              :y="(figProp.lineHeight + figProp.textSize * 3) / 2 - figProp.vertMargin * 1.2 + figProp.legendBoxOffset"
                              :style="{fontSize: figProp.axisLabelSize}">(25th, 50th, 75th percentile)</text>
                            <rect :x="figProp.legendRightX" :y="figProp.vertMargin + figProp.legendBoxOffset"
                              :width="figProp.legendBoxWidth"
                              :height="figProp.lineHeight - 2 * figProp.vertMargin" class="seqCompOrthoBox" />
                            <line :x1="figProp.legendRightX + figProp.legendBoxWidth / 2"
                              :y1="figProp.vertMargin + figProp.legendBoxOffset"
                              :x2="figProp.legendRightX + figProp.legendBoxWidth / 2"
                              :y2="figProp.lineHeight - figProp.vertMargin  + figProp.legendBoxOffset"
                              class="seqCompOrthoMedian" />
                            <text :x="figProp.legendRightX + figProp.legendBoxWidth + figProp.horizMargin / 2"
                              :y="(figProp.lineHeight + figProp.textSize) / 2 - figProp.vertMargin * 1.2 + figProp.legendBoxOffset"
                              :style="{fontSize: figProp.textSize}">{{ alignMode === 'enhancer' ? 'Conserved cis-regulatory elements' : 'Promoters of genes with unique orthologues' }}</text>
                            <text :x="figProp.legendRightX + figProp.legendBoxWidth + figProp.horizMargin / 2"
                              :y="(figProp.lineHeight + figProp.textSize * 3) / 2 - figProp.vertMargin * 1.2 + figProp.legendBoxOffset"
                              :style="{fontSize: figProp.axisLabelSize}">(25th, 50th, 75th percentile)</text>
                          </svg>
                          <svg :width="figProp.width" :height="figProp.lineHeight" x="0" :y="getLineY(3)" v-if="alignMode === 'enhancer'">
                            <!-- Draw the two cross marks -->
                            <use class="seqCompCrossEpiMark" :x="figProp.legendLeftX + figProp.legendBoxWidth / 2"
                              xlink:href="#crossMarker" href="#crossMarker"
                              :y="figProp.lineHeight / 2" />
                            <text :x="figProp.legendLeftX + figProp.legendBoxWidth + figProp.horizMargin / 2"
                              :y="(figProp.lineHeight + figProp.textSize - figProp.vertMargin) / 2"
                              :style="{fontSize: figProp.textSize}">EpiAlign hit</text>
                            <use class="seqCompCrossSeqMark" v-if="entry.item.shifted === 'Y'" xlink:href="#crossMarker" href="#crossMarker"
                              :x="figProp.legendRightX + figProp.legendBoxWidth / 2" :y="figProp.lineHeight / 2" />
                            <text :x="figProp.legendRightX + figProp.legendBoxWidth + figProp.horizMargin / 2"
                              :y="(figProp.lineHeight + figProp.textSize - figProp.vertMargin) / 2"
                              :style="{fontSize: figProp.textSize}" v-if="entry.item.shifted === 'Y'">SeqOnly hit</text>
                          </svg>
                        </svg>
                      </div>
                    </div>
                  </div>
                  <div class="flexColumn dataPart flexNoGap" v-if="alignMode === 'enhancer'">
                    <div class="sectionHeader">Epigenome evaluation</div>
                    <div class="flexRow flexWrap flexNoGap flexStart">
                      <div class="subHeader">Epigenome contribution range</div>
                      <div class="svgGraphHolder flexColumn">
                        <svg id="epiContribSvg" :height="figProp.lineHeight * (entry.item.shifted === 'Y' ? 3 : 2.5)" :width="figProp.width" class="svgGraph">
                          <defs>
                            <g id="crossMarker">
                              <line :x1="-figProp.crossSize" :y1="-figProp.crossSize" :x2="figProp.crossSize"
                                :y2="figProp.crossSize" />
                              <line :x1="-figProp.crossSize" :y1="figProp.crossSize" :x2="figProp.crossSize"
                                :y2="-figProp.crossSize" />
                            </g>
                          </defs>
                          <svg :width="figProp.width" :height="figProp.lineHeight" x="0" :y="getLineY(0)">
                            <!-- Draw the number labels -->
                            <text :x="getXEpiScore(entry.item, getEpiContribEpiHit(entry.item))" :y="figProp.axisLabelSize"
                              :style="{fontSize: figProp.axisLabelSize}" text-anchor="middle">
                              EpiAlign hit</text>
                          </svg>
                          <svg :width="figProp.width" :height="figProp.lineHeight" x="0" :y="getLineY(0.5)">
                            <!-- Draw the two box plots -->
                            <rect :x="figProp.horizMargin + figProp.epiContribLabelSize" :y="figProp.vertMargin"
                              :width="figProp.width - 2 * (figProp.horizMargin + figProp.epiContribLabelSize)"
                              :height="figProp.lineHeight - 2 * figProp.vertMargin" class="seqCompOrthoBox" />
                            <!-- Draw the two cross marks -->
                            <use :class="{ seqCompCrossSeqMark: entry.item.shifted === 'Y', seqCompCrossEpiMark: entry.item.shifted !== 'Y' }"
                              xlink:href="#crossMarker" href="#crossMarker"
                              :x="getXEpiScore(entry.item, getEpiContribSeqHit(entry.item))" :y="figProp.lineHeight / 2" />
                            <use class="seqCompCrossEpiMark" xlink:href="#crossMarker" href="#crossMarker" v-if="entry.item.shifted === 'Y'"
                              :x="getXEpiScore(entry.item, getEpiContribEpiHit(entry.item))" :y="figProp.lineHeight / 2" />
                          </svg>
                          <svg :width="figProp.width" :height="figProp.lineHeight" x="0" :y="getLineY(1.5)" v-if="entry.item.shifted === 'Y'">
                            <!-- Draw the number labels -->
                            <text :x="getXEpiScore(entry.item, getEpiContribSeqHit(entry.item))"
                              :y="figProp.axisLabelSize" :style="{fontSize: figProp.axisLabelSize}"
                              text-anchor="middle">
                              SeqOnly hit</text>
                          </svg>
                          <svg :width="figProp.width" :height="figProp.lineHeight" x="0" :y="getLineY(entry.item.shifted === 'Y' ? 2 : 1.5)">
                            <line :x1="figProp.horizMargin / 2" :y1="figProp.vertMargin + 0.5" :x2="figProp.width - figProp.horizMargin / 2"
                              :y2="figProp.vertMargin + 0.5" class="seqCompAxis" marker-end="url(#arrowHead)" />
                            <!-- Draw all the tick marks -->
                            <g v-for="tick in getTickList(getEpiContribMin(entry.item), getEpiContribMax(entry.item), figProp.maxNumOfTicks)">
                              <line :x1="getXEpiScore(entry.item, tick)" :y1="figProp.vertMargin + 0.5" :x2="getXEpiScore(entry.item, tick)"
                                :y2="figProp.vertMargin + figProp.tickSize + 0.5" class="seqCompAxis" />
                              <text :x="getXEpiScore(entry.item, tick)" :y="figProp.vertMargin + figProp.tickSize + figProp.axisLabelSize + 0.5"
                                :style="{ fontSize: figProp.axisLabelSize }" text-anchor="middle">{{ tick }}</text>
                            </g>
                          </svg>
                        </svg>
                      </div>
                    </div>
                  </div>
                  <div class="flexColumn dataPart flexNoGap" v-if="alignMode === 'enhancer'">
                    <div class="sectionHeader">Expression value of surrounding genes</div>
                    <div class="flexRow flexCenter flexWrap">
                      <table class="expressionTable">
                        <thead>
                          <tr>
                            <th>Gene symbol</th>
                            <th>Distance to query / target region</th>
                            <th>FPKM value(s)</th>
                          </tr>
                        </thead>
                        <tbody>
                          <template v-for="(expInRef, refIndex) in entry.item.expression">
                            <tr>
                              <th colspan="3">{{ expInRef.refName }}</th>
                            </tr>
                            <tr v-for="geneEntry in expInRef.expValues">
                              <td>{{ geneEntry.symbol }}</td>
                              <td class="rightAlign">{{ geneEntry.distance > 0 ? geneEntry.distance : 'Overlapping' }}</td>
                              <td class="flexColumn flexEnd">
                                <div v-for="(expEntry, expIndex) in geneEntry.indExpValues" class="flexRow flexNoGap flexCenter">
                                  <div class="expColorSquare" :style="{ background: '#' + getColorString(entry.item.expression, refIndex, expIndex) }">
                                  </div>
                                  {{ Number.parseFloat(expEntry.FPKM).toFixed(3) }}
                                </div>
                              </td>
                            </tr>
                          </template>
                        </tbody>
                      </table>
                      <div class="flexColumn flexWrap figureLegend">
                        <!-- Legend for expression, populate from expInRef.expIds -->
                        <template v-for="(expInRef, refIndex) in entry.item.expression">
                          <div v-for="(expId, expIndex) in expInRef.expIds"
                            class="flexRow flexCenter flexNoWrap flexNoGap noFlex expLegendEntry">
                            <div class="expColorSquare" :style="{ background: '#' + getColorString(entry.item.expression, refIndex, expIndex) }">
                            </div>
                            <a v-if="buildLinkFromExpressionId(expId)" :href="buildLinkFromExpressionId(expId)" target="_blank">{{ expId }}</a>
                            <span v-else>{{ expId }}</span>
                          </div>
                        </template>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </v-card>
          </template>
        </v-data-table>
        <div id="embeddedBrowser"></div>
      </div>
    </div>
  </div>
  <div id="footer" class="flexRow flexWrap flexCenter noFlex justifyEnd">
    <div class="flex flexColumn flexStretch flexNoGap">
      <!-- footer text -->
      <div>Copyright © 2018 The Regents of the University of California. All Rights
        Reserved.</div>
      <div class="flex flexRow flexWrap flexStretch flexNoGap">
        <div>Created by Jia Lu, Xiaoyi Cao and Sheng Zhong, Department of
          Bioengineering.</div>
        <a href='&#109;&#097;&#105;&#108;&#116;&#111;:&#115;&#122;&#104;&#111;&#110;&#103;&#064;&#101;&#110;&#103;&#046;&#117;&#099;&#115;&#100;&#046;&#101;&#100;&#117;'>Contact
          us via email</a>
        <a href="https://github.com/Zhong-Lab-UCSD/EpiAlignment_WebApp" target="_blank">Find us on Github</a>
      </div>
    </div>
    <img id="ucsdLogo" src="assets/images/UCSanDiegoLogo-White.png">
  </div>
</body>

</html>